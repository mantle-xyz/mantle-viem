import { describe, expect, test } from "vitest";

import { createClient, http } from "viem";
import { getBlock, getTransaction, getTransactionReceipt } from "viem/actions";
import { anvilMantleSepolia } from "../../test/src/anvil.js";
import { mantleSepoliaTestnet } from "./chains/index.js";

const mantleSepoliaClient = anvilMantleSepolia.getClient();

describe("block", () => {
	test("formatter", async () => {
		const { block } = mantleSepoliaTestnet.formatters!;

		expect(
			block.format({
				baseFeePerGas: "0x1",
				blobGasUsed: "0x0",
				excessBlobGas: "0x0",
				sealFields: ["0x0"],
				difficulty: "0x0",
				extraData: "0x",
				gasLimit: "0x420",
				gasUsed: "0x69",
				hash: "0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
				logsBloom:
					"0x0000008002000011000c200080000012000010000400000010040000001000a010001010400002810016001000100001080000090000008020804000002022408010c800290400202090000c000020000081000080440000200000000460800100000000024000400040480002132800000010800000040802000198020000000012000000804001401000000000000001840000002000000000004000000000268080000008c1a024000804000800020000200000080000004000a0000000008404000208000000000800015030000001800250000800001001000a100030001010811020000008000000000040100804001000409000000000480008010010",
				miner: "0x4200000000000000000000000000000000000011",
				mixHash:
					"0x324be0a5ff604a0e2c11541ebfd5850046d6d9044fb2e3c93716080cb02f4887",
				nonce: "0x0000000000000000",
				number: "0x69420",
				parentHash:
					"0x15274362f5bf7aa966ec2eb95c972fd85f2917da803ab178bced6a53479752b6",
				receiptsRoot:
					"0x4cfa86d92cf2d52d2bca8b901592a5a0444be409793f0a4c2af006c0c7aafbde",
				sha3Uncles:
					"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
				size: "0x69420",
				stateRoot:
					"0x95676f3a28d2c8a0bf64db60e910dc47275d37f5a3c3d7353b6f571c25fcd746",
				timestamp: "0xa42069",
				totalDifficulty: "0x0",
				transactionsRoot:
					"0xe41f41da49507646478023c060078f8afa962973ac38da1f7efd0355363b31d5",
				transactions: [
					{
						blockHash:
							"0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
						blockNumber: "0x1",
						from: "0xdeaddeaddeaddeaddeaddeaddeaddeaddead0001",
						gas: "0x420",
						hash: "0xf169b1021e555a1088b69e693938efd32a98231417eda1fb024de83aad98663a",
						maxFeePerGas: "0x0",
						maxPriorityFeePerGas: "0x0",
						input:
							"0x015d8eb900000000000000000000000000000000000000000000000000000000010b6402000000000000000000000000000000000000000000000000000000006492207b000000000000000000000000000000000000000000000000000000033601dfdd1eca1cc72d59c84864665457586b5e8910fb78a19fbffd1a23190862dc7f9dd900000000000000000000000000000000000000000000000000000000000000000000000000000000000000006887246668a3b87f54deb3b94ba47a6f63f3298500000000000000000000000000000000000000000000000000000000000000bc00000000000000000000000000000000000000000000000000000000000a6fe0",
						mint: "0x0",
						nonce: "0x420",
						r: "0x0",
						s: "0x0",
						sourceHash:
							"0x0456be3615ad9f8bb63410c832db98c02d4fdeda0139f4f98186970aef5111df",
						to: "0x4200000000000000000000000000000000000015",
						transactionIndex: "0x0",
						type: "0x7e",
						v: "0x0",
						value: "0x0",
						yParity: "0x0",
					},
					{
						blockHash:
							"0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
						blockNumber: "0x1",
						from: "0xdeaddeaddeaddeaddeaddeaddeaddeaddead0001",
						gas: "0x420",
						hash: "0xf169b1021e555a1088b69e693938efd32a98231417eda1fb024de83aad98663a",
						maxFeePerGas: "0x0",
						maxPriorityFeePerGas: "0x0",
						input:
							"0x015d8eb900000000000000000000000000000000000000000000000000000000010b6402000000000000000000000000000000000000000000000000000000006492207b000000000000000000000000000000000000000000000000000000033601dfdd1eca1cc72d59c84864665457586b5e8910fb78a19fbffd1a23190862dc7f9dd900000000000000000000000000000000000000000000000000000000000000000000000000000000000000006887246668a3b87f54deb3b94ba47a6f63f3298500000000000000000000000000000000000000000000000000000000000000bc00000000000000000000000000000000000000000000000000000000000a6fe0",
						mint: undefined,
						nonce: "0x420",
						r: "0x0",
						s: "0x0",
						sourceHash:
							"0x0456be3615ad9f8bb63410c832db98c02d4fdeda0139f4f98186970aef5111df",
						to: "0x4200000000000000000000000000000000000015",
						transactionIndex: "0x0",
						type: "0x7e",
						v: "0x0",
						value: "0x0",
						yParity: "0x0",
					},
				],
				uncles: [],
			}),
		).toMatchInlineSnapshot(`
      {
        "baseFeePerGas": 1n,
        "blobGasUsed": 0n,
        "difficulty": 0n,
        "excessBlobGas": 0n,
        "extraData": "0x",
        "gasLimit": 1056n,
        "gasUsed": 105n,
        "hash": "0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
        "logsBloom": "0x0000008002000011000c200080000012000010000400000010040000001000a010001010400002810016001000100001080000090000008020804000002022408010c800290400202090000c000020000081000080440000200000000460800100000000024000400040480002132800000010800000040802000198020000000012000000804001401000000000000001840000002000000000004000000000268080000008c1a024000804000800020000200000080000004000a0000000008404000208000000000800015030000001800250000800001001000a100030001010811020000008000000000040100804001000409000000000480008010010",
        "miner": "0x4200000000000000000000000000000000000011",
        "mixHash": "0x324be0a5ff604a0e2c11541ebfd5850046d6d9044fb2e3c93716080cb02f4887",
        "nonce": "0x0000000000000000",
        "number": 431136n,
        "parentHash": "0x15274362f5bf7aa966ec2eb95c972fd85f2917da803ab178bced6a53479752b6",
        "receiptsRoot": "0x4cfa86d92cf2d52d2bca8b901592a5a0444be409793f0a4c2af006c0c7aafbde",
        "sealFields": [
          "0x0",
        ],
        "sha3Uncles": "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
        "size": 431136n,
        "stateRoot": "0x95676f3a28d2c8a0bf64db60e910dc47275d37f5a3c3d7353b6f571c25fcd746",
        "timestamp": 10756201n,
        "totalDifficulty": 0n,
        "transactions": [
          {
            "blockHash": "0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
            "blockNumber": 1n,
            "chainId": undefined,
            "from": "0xdeaddeaddeaddeaddeaddeaddeaddeaddead0001",
            "gas": 1056n,
            "gasPrice": undefined,
            "hash": "0xf169b1021e555a1088b69e693938efd32a98231417eda1fb024de83aad98663a",
            "input": "0x015d8eb900000000000000000000000000000000000000000000000000000000010b6402000000000000000000000000000000000000000000000000000000006492207b000000000000000000000000000000000000000000000000000000033601dfdd1eca1cc72d59c84864665457586b5e8910fb78a19fbffd1a23190862dc7f9dd900000000000000000000000000000000000000000000000000000000000000000000000000000000000000006887246668a3b87f54deb3b94ba47a6f63f3298500000000000000000000000000000000000000000000000000000000000000bc00000000000000000000000000000000000000000000000000000000000a6fe0",
            "isSystemTx": undefined,
            "maxFeePerBlobGas": undefined,
            "maxFeePerGas": 0n,
            "maxPriorityFeePerGas": 0n,
            "mint": 0n,
            "nonce": 1056,
            "r": "0x0",
            "s": "0x0",
            "sourceHash": "0x0456be3615ad9f8bb63410c832db98c02d4fdeda0139f4f98186970aef5111df",
            "to": "0x4200000000000000000000000000000000000015",
            "transactionIndex": 0,
            "type": "deposit",
            "typeHex": "0x7e",
            "v": 0n,
            "value": 0n,
            "yParity": 0,
          },
          {
            "blockHash": "0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
            "blockNumber": 1n,
            "chainId": undefined,
            "from": "0xdeaddeaddeaddeaddeaddeaddeaddeaddead0001",
            "gas": 1056n,
            "gasPrice": undefined,
            "hash": "0xf169b1021e555a1088b69e693938efd32a98231417eda1fb024de83aad98663a",
            "input": "0x015d8eb900000000000000000000000000000000000000000000000000000000010b6402000000000000000000000000000000000000000000000000000000006492207b000000000000000000000000000000000000000000000000000000033601dfdd1eca1cc72d59c84864665457586b5e8910fb78a19fbffd1a23190862dc7f9dd900000000000000000000000000000000000000000000000000000000000000000000000000000000000000006887246668a3b87f54deb3b94ba47a6f63f3298500000000000000000000000000000000000000000000000000000000000000bc00000000000000000000000000000000000000000000000000000000000a6fe0",
            "isSystemTx": undefined,
            "maxFeePerBlobGas": undefined,
            "maxFeePerGas": 0n,
            "maxPriorityFeePerGas": 0n,
            "mint": undefined,
            "nonce": 1056,
            "r": "0x0",
            "s": "0x0",
            "sourceHash": "0x0456be3615ad9f8bb63410c832db98c02d4fdeda0139f4f98186970aef5111df",
            "to": "0x4200000000000000000000000000000000000015",
            "transactionIndex": 0,
            "type": "deposit",
            "typeHex": "0x7e",
            "v": 0n,
            "value": 0n,
            "yParity": 0,
          },
        ],
        "transactionsRoot": "0xe41f41da49507646478023c060078f8afa962973ac38da1f7efd0355363b31d5",
        "uncles": [],
      }
    `);

		expect(
			block.format({
				baseFeePerGas: "0x1",
				difficulty: "0x0",
				blobGasUsed: "0x0",
				excessBlobGas: "0x0",
				sealFields: ["0x0"],
				extraData: "0x0",
				gasLimit: "0x420",
				gasUsed: "0x69",
				hash: "0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
				logsBloom:
					"0x0000008002000011000c200080000012000010000400000010040000001000a010001010400002810016001000100001080000090000008020804000002022408010c800290400202090000c000020000081000080440000200000000460800100000000024000400040480002132800000010800000040802000198020000000012000000804001401000000000000001840000002000000000004000000000268080000008c1a024000804000800020000200000080000004000a0000000008404000208000000000800015030000001800250000800001001000a100030001010811020000008000000000040100804001000409000000000480008010010",
				miner: "0x4200000000000000000000000000000000000011",
				mixHash:
					"0x324be0a5ff604a0e2c11541ebfd5850046d6d9044fb2e3c93716080cb02f4887",
				nonce: "0x0000000000000000",
				number: "0x69420",
				parentHash:
					"0x15274362f5bf7aa966ec2eb95c972fd85f2917da803ab178bced6a53479752b6",
				receiptsRoot:
					"0x4cfa86d92cf2d52d2bca8b901592a5a0444be409793f0a4c2af006c0c7aafbde",
				sha3Uncles:
					"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
				size: "0x69420",
				stateRoot:
					"0x95676f3a28d2c8a0bf64db60e910dc47275d37f5a3c3d7353b6f571c25fcd746",
				timestamp: "0xa42069",
				totalDifficulty: "0x0",
				transactionsRoot:
					"0xe41f41da49507646478023c060078f8afa962973ac38da1f7efd0355363b31d5",
				transactions: ["0x"],
				uncles: [],
			}),
		).toMatchInlineSnapshot(`
      {
        "baseFeePerGas": 1n,
        "blobGasUsed": 0n,
        "difficulty": 0n,
        "excessBlobGas": 0n,
        "extraData": "0x0",
        "gasLimit": 1056n,
        "gasUsed": 105n,
        "hash": "0x40b65fabd4bdda5bb716b1a39e761d76a968d5cc54d887d05b47ac6c2c298846",
        "logsBloom": "0x0000008002000011000c200080000012000010000400000010040000001000a010001010400002810016001000100001080000090000008020804000002022408010c800290400202090000c000020000081000080440000200000000460800100000000024000400040480002132800000010800000040802000198020000000012000000804001401000000000000001840000002000000000004000000000268080000008c1a024000804000800020000200000080000004000a0000000008404000208000000000800015030000001800250000800001001000a100030001010811020000008000000000040100804001000409000000000480008010010",
        "miner": "0x4200000000000000000000000000000000000011",
        "mixHash": "0x324be0a5ff604a0e2c11541ebfd5850046d6d9044fb2e3c93716080cb02f4887",
        "nonce": "0x0000000000000000",
        "number": 431136n,
        "parentHash": "0x15274362f5bf7aa966ec2eb95c972fd85f2917da803ab178bced6a53479752b6",
        "receiptsRoot": "0x4cfa86d92cf2d52d2bca8b901592a5a0444be409793f0a4c2af006c0c7aafbde",
        "sealFields": [
          "0x0",
        ],
        "sha3Uncles": "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
        "size": 431136n,
        "stateRoot": "0x95676f3a28d2c8a0bf64db60e910dc47275d37f5a3c3d7353b6f571c25fcd746",
        "timestamp": 10756201n,
        "totalDifficulty": 0n,
        "transactions": [
          "0x",
        ],
        "transactionsRoot": "0xe41f41da49507646478023c060078f8afa962973ac38da1f7efd0355363b31d5",
        "uncles": [],
      }
    `);
	});

	test("action", async () => {
		const block = await getBlock(mantleSepoliaClient, {
			blockNumber: 7200696n,
			includeTransactions: true,
		});

		const { extraData: _extraData, transactions, ...rest } = block;
		expect(transactions[0]).toMatchInlineSnapshot(`
			{
			  "blockHash": "0xda6f356f67760cb9293723c860655cbc73720cfdae9c0f00a6b8543e5f52285a",
			  "blockNumber": 7200696n,
			  "chainId": undefined,
			  "ethValue": "0x0",
			  "from": "0xdeaddeaddeaddeaddeaddeaddeaddeaddead0001",
			  "gas": 1000000n,
			  "gasPrice": 0n,
			  "hash": "0x7c15f8e8aec48871aae6092f1841b8032380602d45046c6a35f5fd5642a62bfa",
			  "input": "0x015d8eb900000000000000000000000000000000000000000000000000000000005a58c500000000000000000000000000000000000000000000000000000000664742040000000000000000000000000000000000000000000000000000000d170724fa54cda8041c57936457cbe4de08de96f4950c243fb16485614755732d4d32927d00000000000000000000000000000000000000000000000000000000000000040000000000000000000000005fb5139834df283b6a4bd7267952f3ea21a573f400000000000000000000000000000000000000000000000000000000000000bc0000000000000000000000000000000000000000000000000000000000002710",
			  "isSystemTx": undefined,
			  "maxFeePerBlobGas": undefined,
			  "maxFeePerGas": undefined,
			  "maxPriorityFeePerGas": undefined,
			  "mint": 0n,
			  "nonce": 6874986,
			  "r": "0x0",
			  "s": "0x0",
			  "sourceHash": "0x973073ce2038189a7354b70e14015d68fcd339e3f212baae77c418e34c2d8371",
			  "to": "0x4200000000000000000000000000000000000015",
			  "transactionIndex": 0,
			  "type": "deposit",
			  "typeHex": "0x7e",
			  "v": 0n,
			  "value": 0n,
			  "yParity": 0,
			}
		`);
		expect(rest).toMatchInlineSnapshot(`
			{
			  "baseFeePerGas": 20000000n,
			  "blobGasUsed": undefined,
			  "difficulty": 0n,
			  "excessBlobGas": undefined,
			  "gasLimit": 1000000000000n,
			  "gasUsed": 46889n,
			  "hash": "0xda6f356f67760cb9293723c860655cbc73720cfdae9c0f00a6b8543e5f52285a",
			  "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			  "miner": "0x4200000000000000000000000000000000000011",
			  "mixHash": "0x54ce449f723b49ba0b5ffdace7b3bfcb8a26dab458371f0fae5257dc521f439b",
			  "nonce": "0x0000000000000000",
			  "number": 7200696n,
			  "parentHash": "0x1295665943537a8d56f0e52ee4024e4a23f8a12e98fa981c2f17c832cbf6ded9",
			  "receiptsRoot": "0x8f468282575b3a1ccef67b268423ac1c52e9b72ca3bda3cb187069dd45a8443b",
			  "sha3Uncles": "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
			  "size": 875n,
			  "stateRoot": "0xa961c4dc6ea8ffa162f4d85db966026c67e624379759f6bdcaa94a0688c68dd3",
			  "timestamp": 1715946065n,
			  "totalDifficulty": 0n,
			  "transactionsRoot": "0xcbdca18dc4834fc0d49cfc130a469063ccc3d385988b01301d1852192178bf1b",
			  "uncles": [],
			}
		`);
	});
});

describe("transaction", () => {
	test("formatter", () => {
		const { transaction } = mantleSepoliaTestnet.formatters!;

		expect(
			transaction.format({
				accessList: [],
				blockHash:
					"0xd981071322be9757dc3b5479a84d61b4f1f5dd2d44ecb66463be6cfc8246f574",
				blockNumber: "0x1",
				chainId: "0x1",
				from: "0xacd03d601e5bb1b275bb94076ff46ed9d753435a",
				gas: "0x69",
				hash: "0x64241d12d64bb6106a9e818d83d4c9f5d49ebef3c6180e58979bf5894461f822",
				input: "0x",
				maxFeePerGas: "0x1",
				maxPriorityFeePerGas: "0x2",
				nonce: "0x3",
				r: "0xf5272819865bb23110822bedd12b4f14a9b89ca113e280d40ec06c83d126090e",
				s: "0xaaa4249c6b174d714cd6d1eaf1a15a9549769addfcc6d846524f1f8ce38178a",
				to: "0xeb610a69341aace81ed810ed42428249512378cd",
				transactionIndex: "0x4",
				type: "0x2",
				v: "0x1",
				value: "0x69",
				yParity: "0x1",
			}),
		).toMatchInlineSnapshot(`
      {
        "accessList": [],
        "blockHash": "0xd981071322be9757dc3b5479a84d61b4f1f5dd2d44ecb66463be6cfc8246f574",
        "blockNumber": 1n,
        "chainId": 1,
        "from": "0xacd03d601e5bb1b275bb94076ff46ed9d753435a",
        "gas": 105n,
        "gasPrice": undefined,
        "hash": "0x64241d12d64bb6106a9e818d83d4c9f5d49ebef3c6180e58979bf5894461f822",
        "input": "0x",
        "maxFeePerGas": 1n,
        "maxPriorityFeePerGas": 2n,
        "nonce": 3,
        "r": "0xf5272819865bb23110822bedd12b4f14a9b89ca113e280d40ec06c83d126090e",
        "s": "0xaaa4249c6b174d714cd6d1eaf1a15a9549769addfcc6d846524f1f8ce38178a",
        "to": "0xeb610a69341aace81ed810ed42428249512378cd",
        "transactionIndex": 4,
        "type": "eip1559",
        "typeHex": "0x2",
        "v": 1n,
        "value": 105n,
        "yParity": 1,
      }
    `);
	});

	test("action", async () => {
		const transaction = await getTransaction(mantleSepoliaClient, {
			hash: "0x4649507c557704fcb0047a02b90b1b031630336348ed3ebb97210fa9491d8b33",
		});

		expect(transaction).toMatchInlineSnapshot(`
			{
			  "accessList": [],
			  "blockHash": "0xb0cb804c1d50fec74c299515795042d99b81e5ab05ebfb1c3c5d4dacbdd65b89",
			  "blockNumber": 11917201n,
			  "chainId": 5003,
			  "from": "0xd9a0a16e5a634bf5a02962b667f17c65bae14086",
			  "gas": 1077145604n,
			  "gasPrice": 20000000n,
			  "hash": "0x4649507c557704fcb0047a02b90b1b031630336348ed3ebb97210fa9491d8b33",
			  "input": "0x32b7006d000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead111100000000000000000000000000000000000000000000000000957588590e5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000",
			  "maxFeePerGas": 20000000n,
			  "maxPriorityFeePerGas": 20000000n,
			  "nonce": 465,
			  "r": "0x18ebaf3cf51b1c976973087a9e0ddb40bc6c631a8b2bb6813554864a0941e2c7",
			  "s": "0x1d97a0a0e3ae957dba304bf96c85afa05291452a010c9a6193564bbb218d266e",
			  "to": "0x4200000000000000000000000000000000000010",
			  "transactionIndex": 1,
			  "type": "eip1559",
			  "typeHex": "0x2",
			  "v": 1n,
			  "value": 0n,
			  "yParity": 1,
			}
		`);
	});
});

describe("transaction (deposit)", () => {
	test("formatter", () => {
		const { transaction } = mantleSepoliaTestnet.formatters!;

		expect(
			transaction.format({
				blockHash:
					"0xd981071322be9757dc3b5479a84d61b4f1f5dd2d44ecb66463be6cfc8246f574",
				blockNumber: "0x1",
				from: "0xacd03d601e5bb1b275bb94076ff46ed9d753435a",
				gas: "0x69",
				hash: "0x64241d12d64bb6106a9e818d83d4c9f5d49ebef3c6180e58979bf5894461f822",
				input: "0x",
				maxFeePerGas: "0x1",
				maxPriorityFeePerGas: "0x2",
				nonce: "0x3",
				r: "0xf5272819865bb23110822bedd12b4f14a9b89ca113e280d40ec06c83d126090e",
				s: "0xaaa4249c6b174d714cd6d1eaf1a15a9549769addfcc6d846524f1f8ce38178a",
				sourceHash: "0x",
				to: "0xeb610a69341aace81ed810ed42428249512378cd",
				transactionIndex: "0x4",
				type: "0x7e",
				v: "0x1",
				value: "0x69",
				yParity: "0x1",
			}),
		).toMatchInlineSnapshot(`
      {
        "blockHash": "0xd981071322be9757dc3b5479a84d61b4f1f5dd2d44ecb66463be6cfc8246f574",
        "blockNumber": 1n,
        "chainId": undefined,
        "from": "0xacd03d601e5bb1b275bb94076ff46ed9d753435a",
        "gas": 105n,
        "gasPrice": undefined,
        "hash": "0x64241d12d64bb6106a9e818d83d4c9f5d49ebef3c6180e58979bf5894461f822",
        "input": "0x",
        "isSystemTx": undefined,
        "maxFeePerBlobGas": undefined,
        "maxFeePerGas": 1n,
        "maxPriorityFeePerGas": 2n,
        "mint": undefined,
        "nonce": 3,
        "r": "0xf5272819865bb23110822bedd12b4f14a9b89ca113e280d40ec06c83d126090e",
        "s": "0xaaa4249c6b174d714cd6d1eaf1a15a9549769addfcc6d846524f1f8ce38178a",
        "sourceHash": "0x",
        "to": "0xeb610a69341aace81ed810ed42428249512378cd",
        "transactionIndex": 4,
        "type": "deposit",
        "typeHex": "0x7e",
        "v": 1n,
        "value": 105n,
        "yParity": 1,
      }
    `);
	});

	test("action", async () => {
		const transaction = await getTransaction(mantleSepoliaClient, {
			hash: "0xb44587742995319898a6d7241e2e6b749e6d570efb34f9f359572b2f7367ca92",
		});

		expect(transaction).toMatchInlineSnapshot(`
			{
			  "blockHash": "0x96d0af43422dc712a0fd82d97093951a2346faba530846bb145c1f66e34f03b9",
			  "blockNumber": 15750174n,
			  "chainId": undefined,
			  "ethValue": "0x0",
			  "from": "0x48ebc5312e31adb8bb0802fc72ca84da5cdfdc5d",
			  "gas": 591926n,
			  "gasPrice": 0n,
			  "hash": "0xb44587742995319898a6d7241e2e6b749e6d570efb34f9f359572b2f7367ca92",
			  "input": "0xff8daf15000100000000000000000000000000000000000000000000000000000000f75f00000000000000000000000021f308067241b2028503c07bd7cb3751ffab0fb2000000000000000000000000420000000000000000000000000000000000001000000000000000000000000000000000000000000000002b5e3af16b1880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030d4000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000a4f407a99e0000000000000000000000001dae2593c1ea98840882e8c7c4b0509415aff1c10000000000000000000000001dae2593c1ea98840882e8c7c4b0509415aff1c100000000000000000000000000000000000000000000002b5e3af16b188000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			  "isSystemTx": undefined,
			  "maxFeePerBlobGas": undefined,
			  "maxFeePerGas": undefined,
			  "maxPriorityFeePerGas": undefined,
			  "mint": 800000000000000000000n,
			  "nonce": 63416,
			  "r": "0x0",
			  "s": "0x0",
			  "sourceHash": "0x635b2d77d1cd913eb3ccb4ae7749234a79b618e4726093677f1a05bbf9ac7c80",
			  "to": "0x4200000000000000000000000000000000000007",
			  "transactionIndex": 1,
			  "type": "deposit",
			  "typeHex": "0x7e",
			  "v": 0n,
			  "value": 800000000000000000000n,
			  "yParity": 0,
			}
		`);
	});
});

describe("transaction receipt", async () => {
	test("formatter", () => {
		const { transactionReceipt } = mantleSepoliaTestnet.formatters!;

		expect(
			transactionReceipt.format({
				blockHash:
					"0x7f9f15ca4806d8f8deb2c73e82a2a153a2de668118e14e27a96cd672936449f0",
				blockNumber: "0x1",
				contractAddress: null,
				cumulativeGasUsed: "0x1",
				effectiveGasPrice: "0x1",
				from: "0x24476ac81915c512b0e13207aa917923fba4a16a",
				gasUsed: "0x42069",
				l1Fee: "0x420",
				l1FeeScalar: "1.5",
				l1GasPrice: "0x69",
				l1GasUsed: "0x1",
				logs: [],
				logsBloom:
					"0x00000000000000004000000000000000000040000000021000000000000010102000000000000000000080000010000000000000000000000000000000000000004000000000000000000008000008000000000000000000000000000000000000040000060000000080100000000800000000000000000000000010000100000000000400000000000000000000000000000000280000000000000000000000000000004000020000000004000000008000000000000000000000000010000000001002000008000000000000000000000000000000000000000000000020001000800000000000000000002000100000010000000000000000000000000000",
				status: "0x1",
				to: "0xdd69db25f6d620a7bad3023c5d32761d353d3de9",
				transactionHash:
					"0x4d8f0ebd260ea5ac2e11886cdd0af8cba982b21d9f9c1efad808212c6d6a65d3",
				transactionIndex: "0x1",
				type: "0x2",
			}),
		).toMatchInlineSnapshot(`
      {
        "blockHash": "0x7f9f15ca4806d8f8deb2c73e82a2a153a2de668118e14e27a96cd672936449f0",
        "blockNumber": 1n,
        "contractAddress": null,
        "cumulativeGasUsed": 1n,
        "effectiveGasPrice": 1n,
        "from": "0x24476ac81915c512b0e13207aa917923fba4a16a",
        "gasUsed": 270441n,
        "l1Fee": 1056n,
        "l1FeeScalar": 1.5,
        "l1GasPrice": 105n,
        "l1GasUsed": 1n,
        "logs": [],
        "logsBloom": "0x00000000000000004000000000000000000040000000021000000000000010102000000000000000000080000010000000000000000000000000000000000000004000000000000000000008000008000000000000000000000000000000000000040000060000000080100000000800000000000000000000000010000100000000000400000000000000000000000000000000280000000000000000000000000000004000020000000004000000008000000000000000000000000010000000001002000008000000000000000000000000000000000000000000000020001000800000000000000000002000100000010000000000000000000000000000",
        "status": "success",
        "to": "0xdd69db25f6d620a7bad3023c5d32761d353d3de9",
        "transactionHash": "0x4d8f0ebd260ea5ac2e11886cdd0af8cba982b21d9f9c1efad808212c6d6a65d3",
        "transactionIndex": 1,
        "type": "eip1559",
      }
    `);

		expect(
			transactionReceipt.format({
				blockHash:
					"0x7f9f15ca4806d8f8deb2c73e82a2a153a2de668118e14e27a96cd672936449f0",
				blockNumber: "0x1",
				contractAddress: null,
				cumulativeGasUsed: "0x1",
				effectiveGasPrice: "0x1",
				from: "0x24476ac81915c512b0e13207aa917923fba4a16a",
				gasUsed: "0x42069",
				l1Fee: null,
				l1FeeScalar: null,
				l1GasPrice: null,
				l1GasUsed: null,
				logs: [],
				logsBloom:
					"0x00000000000000004000000000000000000040000000021000000000000010102000000000000000000080000010000000000000000000000000000000000000004000000000000000000008000008000000000000000000000000000000000000040000060000000080100000000800000000000000000000000010000100000000000400000000000000000000000000000000280000000000000000000000000000004000020000000004000000008000000000000000000000000010000000001002000008000000000000000000000000000000000000000000000020001000800000000000000000002000100000010000000000000000000000000000",
				status: "0x1",
				to: "0xdd69db25f6d620a7bad3023c5d32761d353d3de9",
				transactionHash:
					"0x4d8f0ebd260ea5ac2e11886cdd0af8cba982b21d9f9c1efad808212c6d6a65d3",
				transactionIndex: "0x1",
				type: "0x2",
			}),
		).toMatchInlineSnapshot(`
      {
        "blockHash": "0x7f9f15ca4806d8f8deb2c73e82a2a153a2de668118e14e27a96cd672936449f0",
        "blockNumber": 1n,
        "contractAddress": null,
        "cumulativeGasUsed": 1n,
        "effectiveGasPrice": 1n,
        "from": "0x24476ac81915c512b0e13207aa917923fba4a16a",
        "gasUsed": 270441n,
        "l1Fee": null,
        "l1FeeScalar": null,
        "l1GasPrice": null,
        "l1GasUsed": null,
        "logs": [],
        "logsBloom": "0x00000000000000004000000000000000000040000000021000000000000010102000000000000000000080000010000000000000000000000000000000000000004000000000000000000008000008000000000000000000000000000000000000040000060000000080100000000800000000000000000000000010000100000000000400000000000000000000000000000000280000000000000000000000000000004000020000000004000000008000000000000000000000000010000000001002000008000000000000000000000000000000000000000000000020001000800000000000000000002000100000010000000000000000000000000000",
        "status": "success",
        "to": "0xdd69db25f6d620a7bad3023c5d32761d353d3de9",
        "transactionHash": "0x4d8f0ebd260ea5ac2e11886cdd0af8cba982b21d9f9c1efad808212c6d6a65d3",
        "transactionIndex": 1,
        "type": "eip1559",
      }
    `);
	});

	test("action", async () => {
		const client = createClient({
			chain: mantleSepoliaTestnet,
			transport: http(),
		});

		const transaction = await getTransactionReceipt(client, {
			hash: "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
		});

		expect(transaction).toMatchInlineSnapshot(`
			{
			  "blockHash": "0x61f0893a463a35d0f2e51c19801d8749208557659027c9d0f40e5a2912bf1e78",
			  "blockNumber": 14426176n,
			  "contractAddress": null,
			  "cumulativeGasUsed": 718755472n,
			  "effectiveGasPrice": 20000000n,
			  "from": "0xd0e3bd9fdfc791dde8aa45c6227f9310d07a9c80",
			  "gasUsed": 718708607n,
			  "l1Fee": 1600878014382216n,
			  "l1FeeScalar": 0.01,
			  "l1GasPrice": 2382841044n,
			  "l1GasUsed": 15756n,
			  "logs": [
			    {
			      "address": "0xced068a987f93f20e071d450b18e9fa74be6b01d",
			      "blockHash": "0x61f0893a463a35d0f2e51c19801d8749208557659027c9d0f40e5a2912bf1e78",
			      "blockNumber": 14426176n,
			      "data": "0x0000000000000000000000000f1ee88a582f31d92510e300fc1330aa5a525d51000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c015318fa771db56d1755c2f2edb80ec051f130b95abe2b9e1a2e1a319ce526afc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012c0000000000000000000000000000000000000000000000000000000000000044e677ae37000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c000000000000000000000000ced068a987f93f20e071d450b18e9fa74be6b01d00000000000000000000000000000000000000000000000000000000",
			      "logIndex": 0,
			      "removed": false,
			      "topics": [
			        "0x4f4da6666f52e3b6dbc3638d8eae4017722678fe58bca79cd8320817807a65be",
			        "0x36d9c2cb0a7e7b9297f163d034ff449e03eacf878ad6bf294dce7756c9d025e2",
			        "0x0000000000000000000000000000000000000000000000000000000000000000",
			      ],
			      "transactionHash": "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
			      "transactionIndex": 1,
			    },
			    {
			      "address": "0xced068a987f93f20e071d450b18e9fa74be6b01d",
			      "blockHash": "0x61f0893a463a35d0f2e51c19801d8749208557659027c9d0f40e5a2912bf1e78",
			      "blockNumber": 14426176n,
			      "data": "0x0000000000000000000000000f1ee88a582f31d92510e300fc1330aa5a525d51000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c015318fa771db56d1755c2f2edb80ec051f130b95abe2b9e1a2e1a319ce526afc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012c0000000000000000000000000000000000000000000000000000000000000024156194da000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c00000000000000000000000000000000000000000000000000000000",
			      "logIndex": 1,
			      "removed": false,
			      "topics": [
			        "0x4f4da6666f52e3b6dbc3638d8eae4017722678fe58bca79cd8320817807a65be",
			        "0x36d9c2cb0a7e7b9297f163d034ff449e03eacf878ad6bf294dce7756c9d025e2",
			        "0x0000000000000000000000000000000000000000000000000000000000000001",
			      ],
			      "transactionHash": "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
			      "transactionIndex": 1,
			    },
			    {
			      "address": "0xced068a987f93f20e071d450b18e9fa74be6b01d",
			      "blockHash": "0x61f0893a463a35d0f2e51c19801d8749208557659027c9d0f40e5a2912bf1e78",
			      "blockNumber": 14426176n,
			      "data": "0x0000000000000000000000000f1ee88a582f31d92510e300fc1330aa5a525d51000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c015318fa771db56d1755c2f2edb80ec051f130b95abe2b9e1a2e1a319ce526afc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012c00000000000000000000000000000000000000000000000000000000000000444e847fc7000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c0000000000000000000000002979c66fabb41f67451f0bcb2a668382f92959a100000000000000000000000000000000000000000000000000000000",
			      "logIndex": 2,
			      "removed": false,
			      "topics": [
			        "0x4f4da6666f52e3b6dbc3638d8eae4017722678fe58bca79cd8320817807a65be",
			        "0x36d9c2cb0a7e7b9297f163d034ff449e03eacf878ad6bf294dce7756c9d025e2",
			        "0x0000000000000000000000000000000000000000000000000000000000000002",
			      ],
			      "transactionHash": "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
			      "transactionIndex": 1,
			    },
			    {
			      "address": "0xced068a987f93f20e071d450b18e9fa74be6b01d",
			      "blockHash": "0x61f0893a463a35d0f2e51c19801d8749208557659027c9d0f40e5a2912bf1e78",
			      "blockNumber": 14426176n,
			      "data": "0x000000000000000000000000ea8ca8ae1c54fab8d185fc1fd7c2d70bee8a417e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c015318fa771db56d1755c2f2edb80ec051f130b95abe2b9e1a2e1a319ce526afc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012c0000000000000000000000000000000000000000000000000000000000000024c630948d0000000000000000000000005146e856687bab6038e4d1f56da35fce5521823300000000000000000000000000000000000000000000000000000000",
			      "logIndex": 3,
			      "removed": false,
			      "topics": [
			        "0x4f4da6666f52e3b6dbc3638d8eae4017722678fe58bca79cd8320817807a65be",
			        "0x36d9c2cb0a7e7b9297f163d034ff449e03eacf878ad6bf294dce7756c9d025e2",
			        "0x0000000000000000000000000000000000000000000000000000000000000003",
			      ],
			      "transactionHash": "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
			      "transactionIndex": 1,
			    },
			    {
			      "address": "0xced068a987f93f20e071d450b18e9fa74be6b01d",
			      "blockHash": "0x61f0893a463a35d0f2e51c19801d8749208557659027c9d0f40e5a2912bf1e78",
			      "blockNumber": 14426176n,
			      "data": "0x000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c015318fa771db56d1755c2f2edb80ec051f130b95abe2b9e1a2e1a319ce526afc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012c0000000000000000000000000000000000000000000000000000000000000024c630948d0000000000000000000000002979c66fabb41f67451f0bcb2a668382f92959a100000000000000000000000000000000000000000000000000000000",
			      "logIndex": 4,
			      "removed": false,
			      "topics": [
			        "0x4f4da6666f52e3b6dbc3638d8eae4017722678fe58bca79cd8320817807a65be",
			        "0x36d9c2cb0a7e7b9297f163d034ff449e03eacf878ad6bf294dce7756c9d025e2",
			        "0x0000000000000000000000000000000000000000000000000000000000000004",
			      ],
			      "transactionHash": "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
			      "transactionIndex": 1,
			    },
			    {
			      "address": "0x31e86a61efc48f2d1086e77b044a0a12be2984e9",
			      "blockHash": "0x61f0893a463a35d0f2e51c19801d8749208557659027c9d0f40e5a2912bf1e78",
			      "blockNumber": 14426176n,
			      "data": "0x000000000000000000000000ced068a987f93f20e071d450b18e9fa74be6b01d000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000544a944142d000000000000000000000000000000000000000000000000000000000000008015318fa771db56d1755c2f2edb80ec051f130b95abe2b9e1a2e1a319ce526afc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012c000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000003e00000000000000000000000000f1ee88a582f31d92510e300fc1330aa5a525d51000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044e677ae37000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c000000000000000000000000ced068a987f93f20e071d450b18e9fa74be6b01d000000000000000000000000000000000000000000000000000000000000000000000000000000000f1ee88a582f31d92510e300fc1330aa5a525d51000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000024156194da000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c000000000000000000000000000000000000000000000000000000000000000000000000000000000f1ee88a582f31d92510e300fc1330aa5a525d510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000444e847fc7000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c0000000000000000000000002979c66fabb41f67451f0bcb2a668382f92959a100000000000000000000000000000000000000000000000000000000000000000000000000000000ea8ca8ae1c54fab8d185fc1fd7c2d70bee8a417e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000024c630948d0000000000000000000000005146e856687bab6038e4d1f56da35fce5521823300000000000000000000000000000000000000000000000000000000000000000000000000000000cdee7708a96479f6d029741144f458b7fa807a6c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000024c630948d0000000000000000000000002979c66fabb41f67451f0bcb2a668382f92959a10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			      "logIndex": 5,
			      "removed": false,
			      "topics": [
			        "0x87d58fdd48be753fb9ef4ec8a5895086c401506da8b4d752abc90602c3e62d1d",
			        "0x0000000000000000000000000000000000000000000000000000000000000022",
			      ],
			      "transactionHash": "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
			      "transactionIndex": 1,
			    },
			  ],
			  "logsBloom": "0x14000000400000008000000000000010000000000000000000000000000000000000000000000000000000000000000000000080020000000040000000040000020000000000000000000004000000000000000000040000000000000000000008000000020000000000000000000800000000000000000000000000000000000000020000008020000000000000000000000000000000000000004008000000000000000000000000000100000000000000000000800000002000000000400000000000000000000000000000000100000000008000000000000000002060080040000000000000000000000000000000000000008000000004000000000000",
			  "status": "success",
			  "to": "0x31e86a61efc48f2d1086e77b044a0a12be2984e9",
			  "tokenRatio": "0x10a8",
			  "transactionHash": "0x9d1e33b96c311b9d97162a56245c51ce833145507312ffe3388d4be64d4ae3f9",
			  "transactionIndex": 1,
			  "type": "eip1559",
			}
		`);
	});
});
