import { expect, test } from "vitest";
import { mainnetClient } from "~test/src/utils.js";

import { extractTransactionDepositedLogs } from "./extractTransactionDepositedLogs.js";
import { getL2TransactionHash } from "./getL2TransactionHash.js";

test("default", async () => {
	const log = {
		args: {
			from: "0x787b795fE6e43C17C668de16730C3f690fEB8231",
			opaqueData:
				"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000090cb600ff8daf15000100000000000000000000000000000000000000000000000000000000390700000000000000000000000095fc37a27a2f68e3a647cdc081f0a89bb47c30120000000000000000000000004200000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030d4000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e40166a07a000000000000000000000000cda86a272531e8640cd7f1a92c01839911b90bb0000000000000000000000000d5f7838f5c461feff7fe49ea5ebaf7728bb0adfa0000000000000000000000008bb820c251ac194ca770f9f0cdc12b76354e3de60000000000000000000000008bb820c251ac194ca770f9f0cdc12b76354e3de600000000000000000000000000000000000000000000000002a98df2e085d07700000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			to: "0x4200000000000000000000000000000000000007",
			version: 1n,
		},
		blockHash:
			"0x3ad08d99607d6b04df5ea332759f2835fa3396943965c47bbd3a65da4384f366",
		eventName: "TransactionDeposited",
		logIndex: 262,
	} as const;

	const l2Hash = getL2TransactionHash({ log: log as any });

	expect(l2Hash).toEqual(
		"0x37824efe792292078ecb08151e52d66d0d098b47aea81bc3a5a6c3dab208d8bc",
	);
});

test("e2e", async () => {
	const receipt = await mainnetClient.getTransactionReceipt({
		hash: "0xac1f228e28589c958e89bae67e13266fd8e83dcbaf817d7084c648438ff1de2f",
	});

	const [log] = extractTransactionDepositedLogs(receipt);

	const l2Hash = getL2TransactionHash({ log });

	expect(l2Hash).toEqual(
		"0x37824efe792292078ecb08151e52d66d0d098b47aea81bc3a5a6c3dab208d8bc",
	);
});
