import { expect, test } from "vitest";

import { createClient, http } from "viem";
import { getTransactionReceipt } from "viem/actions";
import { mantle } from "viem/chains";
import { extractWithdrawalMessageLogs } from "./extractWithdrawalMessageLogs.js";

const client = createClient({
	chain: mantle,
	transport: http(),
});

test("default", async () => {
	const receipt = await getTransactionReceipt(client, {
		hash: "0x0ef55c8c5e84393e980c2e2fe7c437636e2b023c16c469addbbf3f1a3b946db2",
	});
	expect(receipt).toBeDefined();

	const logs = extractWithdrawalMessageLogs(receipt);

	expect(logs).toMatchInlineSnapshot(`
    [
      {
        "address": "0x4200000000000000000000000000000000000016",
        "args": {
          "data": "0xff8daf150001000000000000000000000000000000000000000000000000000000000aa4000000000000000000000000420000000000000000000000000000000000001000000000000000000000000095fc37a27a2f68e3a647cdc081f0a89bb47c301200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e40166a07a000000000000000000000000808507121b80c02388fad14726482e061b8da827000000000000000000000000d27b18915e7acc8fd6ac75db6766a80f8d2f57290000000000000000000000003e23fb0715e9be36eb8d02ce7e50dde80494a90b0000000000000000000000003e23fb0715e9be36eb8d02ce7e50dde80494a90b00000000000000000000000000000000000000000000000da2a96ee35e0bfd2600000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
          "ethValue": 0n,
          "gasLimit": 389904n,
          "mntValue": 0n,
          "nonce": 1766847064778384329583297500742918515827483896875618958121606201292622500n,
          "sender": "0x4200000000000000000000000000000000000007",
          "target": "0x676A795fe6E43C17c668de16730c3F690FEB7120",
          "withdrawalHash": "0x551da43fdd961e2e973ba4c8210dffbeced2a72b37cf1a8ede259b10d6972677",
        },
        "blockHash": "0xb59d91932493a26bc79fca7e0d3ed9d490649b4a5d2b047a5c7561abfa1188fc",
        "blockNumber": 67907325n,
        "data": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005f31000000000000000000000000000000000000000000000000000000000000000a0551da43fdd961e2e973ba4c8210dffbeced2a72b37cf1a8ede259b10d69726770000000000000000000000000000000000000000000000000000000000000204ff8daf150001000000000000000000000000000000000000000000000000000000000aa4000000000000000000000000420000000000000000000000000000000000001000000000000000000000000095fc37a27a2f68e3a647cdc081f0a89bb47c301200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e40166a07a000000000000000000000000808507121b80c02388fad14726482e061b8da827000000000000000000000000d27b18915e7acc8fd6ac75db6766a80f8d2f57290000000000000000000000003e23fb0715e9be36eb8d02ce7e50dde80494a90b0000000000000000000000003e23fb0715e9be36eb8d02ce7e50dde80494a90b00000000000000000000000000000000000000000000000da2a96ee35e0bfd2600000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        "eventName": "MessagePassed",
        "logIndex": 9,
        "removed": false,
        "topics": [
          "0x5da382596b838a63b4248e533d8e399b3b0f13ba6c6679f670489d44716cb173",
          "0x0001000000000000000000000000000000000000000000000000000000000aa4",
          "0x0000000000000000000000004200000000000000000000000000000000000007",
          "0x000000000000000000000000676a795fe6e43c17c668de16730c3f690feb7120",
        ],
        "transactionHash": "0x0ef55c8c5e84393e980c2e2fe7c437636e2b023c16c469addbbf3f1a3b946db2",
        "transactionIndex": 3,
      },
    ]
  `);
});
