import { getTransactionReceipt } from "viem/actions";
import { expect, test } from "vitest";
import { anvilMantle } from "~test/src/anvil.js";
import { getWithdrawals } from "./getWithdrawals.js";

const mantleClient = anvilMantle.getClient();

test("default", async () => {
	const receipt = await getTransactionReceipt(mantleClient, {
		hash: "0x0ef55c8c5e84393e980c2e2fe7c437636e2b023c16c469addbbf3f1a3b946db2",
	});

	const withdrawals = getWithdrawals(receipt);

	expect(withdrawals).toMatchInlineSnapshot(`
    [
      {
        "data": "0xff8daf150001000000000000000000000000000000000000000000000000000000000aa4000000000000000000000000420000000000000000000000000000000000001000000000000000000000000095fc37a27a2f68e3a647cdc081f0a89bb47c301200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e40166a07a000000000000000000000000808507121b80c02388fad14726482e061b8da827000000000000000000000000d27b18915e7acc8fd6ac75db6766a80f8d2f57290000000000000000000000003e23fb0715e9be36eb8d02ce7e50dde80494a90b0000000000000000000000003e23fb0715e9be36eb8d02ce7e50dde80494a90b00000000000000000000000000000000000000000000000da2a96ee35e0bfd2600000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        "ethValue": 0n,
        "gasLimit": 389904n,
        "mntValue": 0n,
        "nonce": 1766847064778384329583297500742918515827483896875618958121606201292622500n,
        "sender": "0x4200000000000000000000000000000000000007",
        "target": "0x676A795fe6E43C17c668de16730c3F690FEB7120",
        "withdrawalHash": "0x551da43fdd961e2e973ba4c8210dffbeced2a72b37cf1a8ede259b10d6972677",
      },
    ]
  `);
});
